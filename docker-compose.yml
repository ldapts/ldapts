services:
  openldap:
    image: osixia/openldap:1.5.0
    ports:
      - '389:389'
      - '636:636'
    command: --copy-service -l=debug
    volumes:
      - ./tests/data/ldif/:/container/service/slapd/assets/config/bootstrap/ldif/custom/
      - ./tests/data/certs/:/container/service/slapd/assets/certs
    environment:
      KEEP_EXISTING_CONFIG: false
      LDAP_DOMAIN: ldap.local
      LDAP_TLS: true
      LDAP_TLS_ENFORCE: false
      LDAP_ADMIN_PASSWORD: 1234
      LDAP_CONFIG_PASSWORD: 1234
      LDAP_REMOVE_CONFIG_AFTER_SETUP: false
      LDAP_TLS_CRT_FILENAME: server.pem
      LDAP_TLS_KEY_FILENAME: server-key.pem
      LDAP_TLS_CA_CRT_FILENAME: ca.pem
      LDAP_TLS_VERIFY_CLIENT: try
      LDAP_TLS_CIPHER_SUITE: "SECURE256:+SECURE128"
    healthcheck:
      test: bash -c "exec 6<> /dev/tcp/localhost/389"
      interval: 60s
      retries: 10
      start_period: 10s
      start_interval: 2s
      timeout: 10s
